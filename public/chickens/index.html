<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="email=no" />

    <script type="text/javascript" src="./javascripts/jquery.js"></script>
    <script type="text/javascript" src="./javascripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="./javascripts/chickens.js"></script>
    <script type="text/javascript" src="./javascripts/jquery.watable.js" charset="utf-8"></script>
    <script type="text/javascript" src="./javascripts/jquery.simple-dtpicker.js"></script>

    <link rel='stylesheet' href="./stylesheets/bootstrap.min.css" />
    <link rel='stylesheet' href='./stylesheets/watable.css'/>
    <link rel='stylesheet' href="./stylesheets/jquery.simple-dtpicker.css" />
    <style type="text/css">body { padding: 0px; font-size: 12px }</style>

</head>
<body>

<input type="text" id="date_foo" value="">
<script type="text/javascript">
    // 保存 date time picker 中正在显示的时间
    if (sessionStorage.showingDate === undefined) {
        alert("init showing daate");
        sessionStorage.showingDate = new Date();
        sessionStorage.showingDate.setMinutes(0);
        sessionStorage.showingDate.setSeconds(0);
        sessionStorage.showingDate.setMilliseconds(0);
    }

    $(function(){

        function datePickerInputTextValue(date) {
            alert("showing date = " + sessionStorage.showingDate);
            return date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate() + " " + date.getHours() + ":00"
        }

        $('#date_foo').appendDtpicker({
            "current": datePickerInputTextValue(sessionStorage.showingDate),
            "locale": "cn",
            "firstDayOfWeek": 1, // 把周一作为一周的第一天
            "closeOnSelected": true,
            "onHide": function(handler) {
                var selectedDate = handler.getDate();
                selectedDate.setMinutes(0);
                //alert("select " + dateHourString(selectedDate) + " show " + dateHourString(shownDate));

                var notSameHour = (shownDate - selectedDate != 0);
                //alert("is same hour = " + !notSameHour);

                if (notSameHour) {
                    shownDate = selectedDate;
                    getChickensData(shownDate);
                }
            }
        });
    });

//    function dateHourString(date) {
//        return date.getFullYear() + "-" + date.getMonth() + "-" + date.getDate() + " " + date.getHours() + ":00:00"
//    }
</script>

<div id="example2" style="width:auto"></div>
<script type="text/javascript">

    $(document).ready( function() {
        alert("create table");

        createTable();

        // 请求数据
        getChickensData(shownDate);
    });

</script>


</body>
</html>
